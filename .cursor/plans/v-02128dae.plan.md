<!-- 02128dae-194b-41dd-8120-b841b5742ed3 f735f86f-2376-47a1-9dba-aa376d4c0201 -->
# Stabilization Plan (Pre-Features)

## Scope

Complete critical stabilization tasks identified in the scan to ensure production readiness before adding new features.

## Priorities

1) Remove console spam, 2) Fix TypeScript anys, 3) Accessibility pass, 4) Navigation consolidation, 5) Performance optimizations, 6) Service consolidation and dependency hygiene.

## Tasks

### A. Centralized Logging & Console Cleanup

- Replace console statements with `logger` across services and screens
- Ensure production log level is warn+ via `utils/logger.ts`
- Key files: `src/services/**`, `src/screens/**`, `src/contexts/**`

### B. TypeScript Quality (replace critical `any`)

- Messaging: `src/services/messagingService.ts` (54)
- Streaming: `src/services/streamingService.ts` (11)
- Currency: `src/services/virtualCurrencyService.ts` (14)
- Agora/Auth: `src/services/agoraService.ts`, `src/services/authService.ts`
- Introduce/extend shared types in `src/services/types.ts`

### C. Accessibility & UX Consistency

- Add `accessibilityLabel/Hint/Role`, ensure 48x48pt targets
- Respect reduced motion; focus indicators and labels
- Screens: `HomeScreen.tsx`, `ChatScreen.tsx`, `LiveScreen.tsx`, `ProfileScreen.tsx`, `NotificationsScreen.tsx`
- Unify auth screens using `AuthDesignSystem` (already dark-aligned)

### D. Navigation Consolidation (expo-router vs React Navigation)

- Decide standard: React Navigation
- Remove expo-router usage from 35 files (e.g., `HomeScreen.tsx`, `LoginScreen.tsx`)
- Update `package.json` main to `node_modules/expo/AppEntry.js`
- Validate deep linking and back behavior

### E. Performance Optimizations

- List virtualization: `DirectMessagesScreen.tsx`, `NotificationsScreen.tsx`, friends lists
- Image caching for avatars via `expo-image`
- Lazy-load non-critical screens using `utils/lazyComponents.ts`
- Define budgets: 16ms frames, transition <200ms

### F. Service Consolidation & Safety

- Merge `monitoringService.ts` into `services/performance.ts` (one API)
- Ensure all storage uses `safeAsyncStorage.ts`
- Sweep for duplicate logic in discovery/analytics services

### G. Dependency & Config Hygiene

- Update `expo-router` mismatch (`~6.0.12`) or remove entirely
- Confirm Google/Apple sign-in in dev build; keep Expo Go fallbacks
- Secrets: confirm .env usage only; avoid hardcoding

## Testing & Validation

- Run `npm run validate` (lint, type-check, tests)
- Expand smoke tests for auth, guest, stream lifecycle
- Run accessibility audit (screen reader pass, tab/focus checks)
- Monitor logs to confirm reduction

## Deliverables

- No console spam in prod, warn+ only
- <50 remaining `any` types in services
- Accessibility coverage on top 5 screens
- Single navigation system
- Virtualized lists and image caching in key screens
- Performance service as single source of truth

## Risks & Mitigations

- Navigation refactor: use feature flag branch and staged rollout
- Type refactors: incremental PRs per service
- Accessibility: collaborate on copy for labels and hints

### To-dos

- [ ] Remove backups and consolidate *_fixed.ts into canonical services
- [ ] Relocate Firebase/GlobalChat test components to __tests__/ui
- [ ] Add env-based logger and replace raw console in core services
- [ ] Add auth/guest guards and try/catch to key services
- [ ] Route storage calls through crash prevention wrappers
- [ ] Add teardown logic in StreamConnectionContext and listeners
- [ ] Add invariant checks in virtualCurrencyService and tests
- [ ] Apply ErrorBoundary/StreamErrorBoundary around Live/Chat
- [ ] Unify performanceMonitor/MonitoringService into single API
- [ ] Define clear contracts between analytics and profile analytics
- [ ] Remove router duplication; keep React Navigation cleanly
- [ ] Implement Shop MVP with purchases and inventory
- [ ] Build Leaderboard MVP using profile analytics
- [ ] Implement Music MVP with playlists and player
- [ ] Ship GoldMiner and Slots MVP with rewards
- [ ] Integrate search/scheduling with messagingService
- [ ] Wire recorder/player into Chat via voiceMessageService
- [ ] Centralize tokens and remove hardcoded styles
- [ ] Adopt LoadingProvider and unified error components
- [ ] Add accessibility labels/hints and reduced motion support
- [ ] Apply list virtualization and image caching
- [ ] Split non-critical screens via lazyComponents
- [ ] Adopt loggingThrottle in streaming/agora/messaging
- [ ] Add basic host analytics dashboard (optional)
- [ ] Expand smoke tests and validate firestore rules